<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="Johan Rosa">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="//img/home_wave.jpg">
    <meta property="twitter:image" content="//img/home_wave.jpg" />
    

    
    <meta name="title" content="La grandeza de Kobe Bryant II: una mirada a su selección de tiros" />
    <meta property="og:title" content="La grandeza de Kobe Bryant II: una mirada a su selección de tiros" />
    <meta property="twitter:title" content="La grandeza de Kobe Bryant II: una mirada a su selección de tiros" />
    

    
    <meta name="description" content="Un Blog personal con contenido de Ciencia de los datos">
    <meta property="og:description" content="Un Blog personal con contenido de Ciencia de los datos" />
    <meta property="twitter:description" content="Un Blog personal con contenido de Ciencia de los datos" />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="Johan Rosa, Rstats, R, Ciencia de datos, data science, dataviz">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>La grandeza de Kobe Bryant II: una mirada a su selección de tiros-Blog de Johan</title>

    <link rel="canonical" href="/post/la-grandeza-de-kobe-bryant-ii-una-mirada-a-su-seleccion-de-tiros/">

    <link rel="stylesheet" href="/css/iDisqus.min.css"/>
	
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    
    <link rel="stylesheet" href="/css/syntax.css">
    
    
    <link rel="stylesheet" href="/css/zanshang.css">
    
    
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    
    

    
    
    <script src="/js/jquery.min.js"></script>
    
    
    <script src="/js/bootstrap.min.js"></script>
    
    
    <script src="/js/hux-blog.min.js"></script>

    
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/docco.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    
    

</head>



<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Johan Rosa</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                    
		    
                        <li><a href="/top/about/">Quién soy</a></li>
                    
                        <li><a href="/top/cv/">CV</a></li>
                    

                    
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('/img/baner/kobe_dunk.jpg')
    }
</style>
<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/ggplot2" title="ggplot2">
                            ggplot2
                        </a>
                        
                        <a class="tag" href="/tags/plotly" title="plotly">
                            plotly
                        </a>
                        
                    </div>
                    <h1>La grandeza de Kobe Bryant II: una mirada a su selección de tiros</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        Publicado por 
                        
                            Johan Rosa
                         
                        el  
                        2020-03-23
                        
                        
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-11 col-lg-offset-1
                col-md-10 col-md-offset-1
                post-container">

                
                <hr>
<h2 id="output-html_document">title: &ldquo;La grandeza de Kobe Bryant II: Selección de tiro&rdquo;
output: html_document</h2>
<p>Tras el fallecimiento de Kobe Bryant me comprometí a postear una serie de entradas relacionadas a él. En esta oportunidad haremos un análisis exploratorio de Kobe Bryant desde la optica de los tiros que tomó en sus 20 años de carrera profesional.</p>
<p>La data que utilizaremos para este análisis tiene la ubicación de cada tiro tomado por Kobe, resultando muy interesante y tentadora para hacer valoraciones y críticas, pero la verdad es que tiene limitaciones para comprender lo legendario de cada tiro tomado por Kobe Bryant.</p>
<p>Las limitaciones que tiene los registros de tiro para hacer valoraciones profundas sobre la selección de tiro de un jugador son muchas, así que voy a resaltar algunas para justificar las razones por las que no haré valoraciones, además de mi condición de fanático e inexperto.</p>
<p>Limitaciones:</p>
<ul>
<li>No hay detalles de la defensa. No sabemos a qué distancia estaba el defensor más cercano, cuantos defensores había, quienes estaba defendiendo (Hay defensores más hábiles que otros)</li>
<li>No hay detalles que los malabares que hizo para llegar a determinada posición.</li>
<li>Esta data puede conducir a interpretaciones burdas, alguien podría concluir que como debajo del aro la eficiencia de tiro de un jugador es mayor, pues debería tomar más tiros de esa zona, cuando en realidad llegar a esa zona es bastante complicado e quizás incremente mucho la posibilidad de pérdidas de balón.</li>
<li>No hay detalles de la posición de los compañeros en la cancha, ni de quienes eran. No podemos decir si había una opción de tiro mejor (Difícil que haya una opción mejor a que kobe la tire).</li>
</ul>
<p>Por estas razones me limitaré a ser completamente descriptivo en este post, además de equilibrar adecuadamente la interpretación de las visualizaciones y los comentarios sobre los detalles y estrategias utilizadas para generarlas. Esto para no aburrir a los que entren a leer sin interés muy profundo en el código, o viceversa.</p>
<h2 id="para-reproducir-el-contenido">Para reproducir el contenido</h2>
<p>Como de costumbre, compartiré el enlace al repositorio  de la publicación en github, pero esta vez y quizás en las próximas ocasiones, compartiré también el enlace del proyecto en rstudio.cloud. Esta segunda opción garantiza la reproducción de todo el contenido, al poner una sección de R en el navegador, con todos los paquetes y archivos utilizados para crear el material.</p>
<ul>
<li><a href="https://rstudio.cloud/project/1010634">Proyecto en rstudio.cloud</a></li>
<li><a href="https://github.com/Johan-rosa/kobe_shot_selection">Repositorio en github</a></li>
</ul>
<p>Por otro lado, para lograr visualizaciones llamativas intenté varias opciones para incorporar los segmentos de la cancha en los gráficos. El primer intento fue colocar una imagen de fondo en los gráficos, pero no lograba ajustar bien las dimensiones y quedaba feo. El segundo intento consistió dibujar las líneas con ggplot2. Para lograr esto me auxilié del código de varias personas, principalmente el de <a href="https://toddwschneider.com/">Todd Wschneider</a> que a su vez se basó en las publicaciones de <a href="http://savvastjortjoglou.com/nba-shot-sharts.html">Savvas Tjortjoglou</a> (por eso amo mundo open source). Menciono esto porque las adaptaciones que le hice a lo que ellos hicieron fueron extensas y por si solas representarían una publicación individual, pero igual pueden acceder a todos los objetos desde el workspace en los repositorios.</p>
<h2 id="la-data">La data</h2>
<p>La data para este análisis es una publicada en <a href="https://www.kaggle.com/">kaggle</a> para una competencia de machine learning. El objetivo de la competencia es utilizar un set de los tiros tomados por Kobe y construir un modelo que clasifique si una serie de observaciones, para las cuales no tenemos el resultado, fueron encestados o no.</p>
<p>Entre las variables que constituyen el set de datos se encuentran las siguientes:</p>
<ul>
<li>Ubicación del tiro, con coordenadas en escala a las dimensiones de una chancha de basket.</li>
<li>Zona del tiro</li>
<li>Distancia respecto al aro</li>
<li>Tiempo restante del cuarto</li>
<li>Tipo de tiro (tablerito, gancho, donqueo, jump shot)</li>
<li>Id del juego</li>
<li>Equipo contrincante</li>
<li>Si el tiro se tomó en playoff o serie regular</li>
<li>Fecha del juego</li>
<li>Resultado del lanzamiento (acierto o fallo)</li>
</ul>
<p>Aqui <a href="https://www.kaggle.com/c/kobe-bryant-shot-selection">Enlace de la competencia</a>, con los detalles sobre el set de datos, el enlace orginal de descarga y algunos notebooks de gente que ha compartido sus análisis y modelos. Es probable que en unos días yo publique el mío también.</p>
<h2 id="manos-a-la-obra">Manos a la obra</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Paquetes</span>
<span style="color:#a6e22e">library</span>(tidyverse)
<span style="color:#a6e22e">library</span>(ggthemes)
<span style="color:#a6e22e">library</span>(patchwork)
<span style="color:#a6e22e">library</span>(tidytext) <span style="color:#75715e"># para usar reorder_within() y scale_y_reordered()</span>

<span style="color:#75715e"># Función para crear los segmentos de la chancha</span>
<span style="color:#75715e"># Esta función fue creada en base al trabajo de Todd Wschneider</span>
<span style="color:#a6e22e">source</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">scripts/court_plot.R&#34;</span>)

<span style="color:#75715e"># Importando la data </span>
shots_data <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read_csv</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">data.csv&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#75715e"># Unas simples transformaciones a las coordenadas de los tiros</span>
  <span style="color:#75715e"># para que sean congruente con la escla de court_points</span>
  <span style="color:#a6e22e">mutate</span>(
    loc_x <span style="color:#f92672">=</span> loc_x<span style="color:#f92672">/</span><span style="color:#ae81ff">10</span>,
    loc_y <span style="color:#f92672">=</span> (loc_y <span style="color:#f92672">+</span> <span style="color:#ae81ff">50</span>)<span style="color:#f92672">/</span><span style="color:#ae81ff">10</span>
  )

<span style="color:#75715e"># Puntos de la cancha</span>
court_points <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">generate_court_points</span>()
</code></pre></div><p>La verdad es que kobe tiraba mucho, tomaba tiros muy difíciles con mucha frecuencia y eso lo llevó a marcar un porcentaje de aciertos cuestionable para algunos. En toda su carrea lanzó cerca de 45% de campo, pero aun así se colocó en el top tres de anotadores de la historia de la NBA (Lebron le pasó días antes de su muerte), también deleitó al mundo con una serie de canastos inigualables.</p>
<p>En general y sin considerar lo tiros libres, kobe tomó 30,697 tiros de campo, de los cuales 24,271 fueron intentos de dos puntos (79.1%) y 6,426 fueron intentos detrás de la línea de tres.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">shots_data <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">count</span>(shot_type) <span style="color:#f92672">%&gt;%</span> 
  janitor<span style="color:#f92672">::</span><span style="color:#a6e22e">adorn_totals</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">row&#34;</span>)
</code></pre></div><pre><code>##       shot_type     n
##  2PT Field Goal 24271
##  3PT Field Goal  6426
##           Total 30697
</code></pre><p>El primer gráfico muestra la distribución de estos tiros en las diferentes temporadas. Kobe tomó mas de 1,000 tiros en la mayoría de las temporadas que jugó y solo tomó menos de 750 tiros en los años de novato y en los años tras la lesión del tendón de Aquiles.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Gráfico de la cantidad de tiros</span>
p1 <span style="color:#f92672">&lt;-</span> shots_data <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(season <span style="color:#f92672">=</span> <span style="color:#a6e22e">parse_number</span>(season), shot_type) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">summarise</span>(fg_percent <span style="color:#f92672">=</span> <span style="color:#a6e22e">mean</span>(shot_made_flag, na.rm <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>),
            tiros <span style="color:#f92672">=</span> <span style="color:#a6e22e">n</span>()) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">ggplot</span>(<span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> season, y <span style="color:#f92672">=</span> tiros, color <span style="color:#f92672">=</span> shot_type)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_line</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_point</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_y_continuous</span>(labels <span style="color:#f92672">=</span> scales<span style="color:#f92672">::</span>comma) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_light</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_color_tableau</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme</span>(
    legend.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">none&#34;</span>,
    axis.text.x <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    axis.title.x <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>()
  ) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(
    x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">&#34;</span>,
    y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Tiros&#34;</span>,
    title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Cantidad de tiros y porcentaje de aciertos por temporada&#34;</span>
  )

<span style="color:#75715e"># Gráfico del porcentaje de campo</span>
p2 <span style="color:#f92672">&lt;-</span> shots_data <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(season <span style="color:#f92672">=</span> <span style="color:#a6e22e">parse_number</span>(season), shot_type) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">summarise</span>(
    fg_percent <span style="color:#f92672">=</span> <span style="color:#a6e22e">mean</span>(shot_made_flag, na.rm <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>),
    tiros <span style="color:#f92672">=</span> <span style="color:#a6e22e">n</span>()
    ) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">ggplot</span>(<span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> season, y <span style="color:#f92672">=</span> fg_percent, color <span style="color:#f92672">=</span> shot_type)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_line</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_point</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_y_continuous</span>(labels <span style="color:#f92672">=</span> scales<span style="color:#f92672">::</span>percent) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">coord_cartesian</span>(ylim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.60</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_light</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_color_tableau</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme</span>(
    legend.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">bottom&#34;</span>
  ) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Temporada&#34;</span>, y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Porcentaje&#34;</span>)
  
p1 <span style="color:#f92672">/</span> p2
</code></pre></div><p><!-- raw HTML omitted -->
Las siguientes visualizaciones exploran los tiros tomados por Kobe pero enfocándose en la posición de la cancha en la que los tomó. Indudablemente el  lugar del tiro influye mucho en la probabilidad de acierto, muchas veces los tiros más alejados suelen fallarse más, o los del lado opuesto a la mano dominante, ect. El set de datos trae 2 variables categóricas con la posición de la cancha en la que se tomó el tiro, por tanto, podemos ver la cantidad y el porcentaje de acierto en cada zona.</p>
<p>Estos gráficos introducen dos cuestiones novedosas:</p>
<ol>
<li>
<p>Usan la función <code>reorder_within()</code> del paquete <code>{tidytext}</code>, creado por Julia Silge y  David Robinson, que permite tener gráficos en facets con ejes organizados independientemente.</p>
</li>
<li>
<p>Usar todo un gráfico como anotación en otro gráfico. Esto puede tener una gran variedad de usos, pero en este caso se utiliza para colocar una leyenda interesante al gráfico. De esta forma hasta alguien poco familiarizado con las dimensiones de una chancha entendería a qué área se refiere cada barra.</p>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Gráfico que funguirá como leyenda</span>
shot_zone2 <span style="color:#f92672">&lt;-</span> shots_data <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#75715e"># excluyendo los tiros antes de cruzar la media chancha</span>
  <span style="color:#a6e22e">filter</span>(shot_zone_area <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Back Court(BC)&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">ggplot</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_point</span>(<span style="color:#a6e22e">aes</span>(
    x <span style="color:#f92672">=</span> loc_x, y <span style="color:#f92672">=</span> loc_y,
    color <span style="color:#f92672">=</span> shot_zone_area), show.legend <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>) <span style="color:#f92672">+</span>
  <span style="color:#75715e"># Agregando las líneas de la chancha</span>
   <span style="color:#a6e22e">geom_path</span>(
    data <span style="color:#f92672">=</span> court_points,
    <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> x, y <span style="color:#f92672">=</span> y, group <span style="color:#f92672">=</span> desc)
  ) <span style="color:#f92672">+</span>
  <span style="color:#75715e"># Tema sin elementos visuales</span>
  <span style="color:#a6e22e">theme_void</span>() <span style="color:#f92672">+</span>
  <span style="color:#75715e"># Mover la leyenda</span>
  <span style="color:#a6e22e">theme</span>(legend.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">right&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#75715e"># una escala de color bonita</span>
  <span style="color:#a6e22e">scale_color_tableau</span>()

<span style="color:#75715e"># Gráfico de barras con los tiros y porcentaje de tiro por zona</span>
shots_data <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">filter</span>(shot_zone_area <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Back Court(BC)&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">group_by</span>(shot_zone_area) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">summarise</span>(
    tiros <span style="color:#f92672">=</span> <span style="color:#a6e22e">n</span>(),
    porcentaje <span style="color:#f92672">=</span> <span style="color:#a6e22e">mean</span>(shot_made_flag, na.rm <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
  ) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#75715e"># colocando la data en formato largo</span>
  <span style="color:#75715e"># en el futuro usen pivote_longer</span>
  <span style="color:#a6e22e">gather</span>(medida, valor, <span style="color:#f92672">-</span>shot_zone_area) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">mutate</span>(
    medida <span style="color:#f92672">=</span> <span style="color:#a6e22e">factor</span>(medida, labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Porcentaje de tiro&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Cantidad de tiros&#34;</span>))
  ) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">ggplot</span>(<span style="color:#a6e22e">aes</span>(
    <span style="color:#75715e"># Creando el factor organizado individualmenet</span>
    x <span style="color:#f92672">=</span> tidytext<span style="color:#f92672">::</span><span style="color:#a6e22e">reorder_within</span>(shot_zone_area, by <span style="color:#f92672">=</span> <span style="color:#a6e22e">desc</span>(valor), within <span style="color:#f92672">=</span> medida),
    y <span style="color:#f92672">=</span> valor,
    fill <span style="color:#f92672">=</span> shot_zone_area)
    ) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_col</span>(show.legend <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, alpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.8</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#f92672">~</span>medida, scales <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">free&#34;</span>) <span style="color:#f92672">+</span>
  tidytext<span style="color:#f92672">::</span><span style="color:#a6e22e">scale_x_reordered</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">coord_flip</span>() <span style="color:#f92672">+</span>
  <span style="color:#75715e"># Agregando el gráfico anterior como anotación</span>
  <span style="color:#a6e22e">annotation_custom</span>(<span style="color:#a6e22e">ggplotGrob</span>(shot_zone2), xmin <span style="color:#f92672">=</span> <span style="color:#ae81ff">3.8</span>, xmax <span style="color:#f92672">=</span> <span style="color:#ae81ff">5.5</span>, ymin <span style="color:#f92672">=</span> <span style="color:#ae81ff">6500</span>, ymax <span style="color:#f92672">=</span> <span style="color:#ae81ff">12000</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_minimal</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_y_continuous</span>(labels <span style="color:#f92672">=</span> scales<span style="color:#f92672">::</span>comma) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme</span>(
    strip.text <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(size <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>, face <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">bold&#34;</span>)
  ) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">&#34;</span>,
       y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">&#34;</span>) <span style="color:#f92672">+</span>
   <span style="color:#a6e22e">scale_fill_tableau</span>()
</code></pre></div><p><!-- raw HTML omitted --></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">shot_zone <span style="color:#f92672">&lt;-</span> shots_data <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">filter</span>(shot_zone_basic <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Backcourt&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">ggplot</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_point</span>(
    <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> loc_x, y <span style="color:#f92672">=</span> loc_y,
        color <span style="color:#f92672">=</span> shot_zone_basic), show.legend <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>
    ) <span style="color:#f92672">+</span>
   <span style="color:#a6e22e">geom_path</span>(
    data <span style="color:#f92672">=</span> court_points,
    <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> x, y <span style="color:#f92672">=</span> y, group <span style="color:#f92672">=</span> desc)
  ) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme</span>(
    axis.text <span style="color:#f92672">=</span> 
  ) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_void</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme</span>(legend.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">right&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>() <span style="color:#f92672">+</span>
   <span style="color:#a6e22e">scale_color_tableau</span>()


shots_data <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">filter</span>(shot_zone_basic <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Backcourt&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">group_by</span>(shot_zone_basic) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">summarise</span>(
    tiros <span style="color:#f92672">=</span> <span style="color:#a6e22e">n</span>(),
    porcentaje <span style="color:#f92672">=</span> <span style="color:#a6e22e">mean</span>(shot_made_flag, na.rm <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
  ) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">gather</span>(medida, valor, <span style="color:#f92672">-</span>shot_zone_basic) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">mutate</span>(
    medida <span style="color:#f92672">=</span> <span style="color:#a6e22e">factor</span>(medida, labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Porcentaje de tiro&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Cantidad de tiros&#34;</span>))
  ) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">ggplot</span>(<span style="color:#a6e22e">aes</span>(
    x <span style="color:#f92672">=</span> tidytext<span style="color:#f92672">::</span><span style="color:#a6e22e">reorder_within</span>(shot_zone_basic, <span style="color:#a6e22e">desc</span>(valor), medida),
    y <span style="color:#f92672">=</span> valor,
    fill <span style="color:#f92672">=</span> shot_zone_basic)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_col</span>(show.legend <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, alpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.8</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#f92672">~</span>medida, scales <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">free&#34;</span>) <span style="color:#f92672">+</span>
  tidytext<span style="color:#f92672">::</span><span style="color:#a6e22e">scale_x_reordered</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">coord_flip</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">annotation_custom</span>(
    <span style="color:#a6e22e">ggplotGrob</span>(shot_zone),
    xmin <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>, xmax <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>,
    ymin <span style="color:#f92672">=</span> <span style="color:#ae81ff">6500</span>, ymax <span style="color:#f92672">=</span> <span style="color:#ae81ff">12000</span>
    ) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_minimal</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_y_continuous</span>(labels <span style="color:#f92672">=</span> scales<span style="color:#f92672">::</span>comma) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme</span>(
    strip.text <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(size <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>, face <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">bold&#34;</span>)
  ) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">&#34;</span>,
       y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">&#34;</span>) <span style="color:#f92672">+</span>
   <span style="color:#a6e22e">scale_fill_tableau</span>()
</code></pre></div><p><!-- raw HTML omitted --></p>
<p>Sin duda la data categórica es interesante, pero creo que resulta más emocionante ver un gráfico de los tiros individuales. Igual, al estar hablando de más de 30,000 puntos, un poco de overlap no debería sorprender. Hay que buscar estrategias para lidear con esto, porque en general el gráfico de puntos no deja ver mucho sobre las zonas en las que kobe era más efectivo o, simplemente, tiraba más.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">shots_data <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">filter</span>(shot_zone_basic <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Backcourt&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">ggplot</span>(<span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> loc_x, y <span style="color:#f92672">=</span> loc_y )) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_point</span>(alpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>, <span style="color:#a6e22e">aes</span>(color <span style="color:#f92672">=</span> <span style="color:#a6e22e">factor</span>(shot_made_flag))) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_path</span>(
    data <span style="color:#f92672">=</span> court_points,
    <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> x, y <span style="color:#f92672">=</span> y, group <span style="color:#f92672">=</span> desc)
  ) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_color_tableau</span>(labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Fallados&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Acertados&#34;</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme</span>(
    axis.text <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    axis.title <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    panel.grid <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    axis.ticks <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    panel.background <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    legend.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">bottom&#34;</span>
  ) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">labs</span>(color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">coord_cartesian</span>(expand <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">ggtitle</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Distribución de los tiros de Kobe&#34;</span>)
</code></pre></div><p><!-- raw HTML omitted --></p>
<p>Hay distintas estrategias para lidiar con overplotting. Entre las más comunes está diminuir la transparencia de los puntos y esperar que las zonas de mayor concentración queden con un color más oscuro. Por otro lado se puede utilizar una geometría especial como  <code>hexbin::geom_hex()</code> que crea una especie de histograma bidimensional, en el que divide el espacio en binds hexagonales y cada uno toma color en función a la cantidad de puntos que cae en cada uno.</p>
<p>Las geometría de densidad bidimensional son otra opción para lidiar con este &ldquo;problema&rdquo;. Estas facilitan mucho la interpretación porque agrupan las observaciones, en &ldquo;circulos&rdquo; con similar cantidad de puntos, de modo los circulos más pequeños tienen mayor densidad. También son una forma de representar en dos dimensiones algo que podría verse en tres.</p>
<p>Aquí se muestran tanto la versión en 2d como la versión 3d. Ahora es más fácil ver de donde metía y fallaba más Kobe.</p>
<p>Para más ejemplos de como lidiar con overplotting pueden consultar las siguientes fuentes: <a href="https://www.data-to-viz.com/caveat/overplotting.html">from data to viz</a> y [R graph gallery], ambas creaciones de <a href="https://github.com/holtzy">Yan Holtz</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">shots_data <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">filter</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">is.na</span>(shot_made_flag)) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">filter</span>(combined_shot_type <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Jump Shot&#34;</span>, shot_zone_basic <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Backcourt&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">mutate</span>(shot_made_flag <span style="color:#f92672">=</span> <span style="color:#a6e22e">factor</span>(shot_made_flag, labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Fallados&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Anotados&#34;</span>))) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">ggplot</span>() <span style="color:#f92672">+</span>
        <span style="color:#a6e22e">stat_density2d</span>(
          geom <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;</span><span style="color:#e6db74">polygon&#39;</span>,
          contour <span style="color:#f92672">=</span> T,
          n <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>,
          <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> loc_x,
              y <span style="color:#f92672">=</span> loc_y,
              color <span style="color:#f92672">=</span> shot_made_flag,
              fill <span style="color:#f92672">=</span> ..level..<span style="color:#f92672">/</span><span style="color:#a6e22e">max</span>(..level..),
              alpha <span style="color:#f92672">=</span> ..level..)
          ) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_path</span>(
    data <span style="color:#f92672">=</span> court_points,
    <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> x, y <span style="color:#f92672">=</span> y, group <span style="color:#f92672">=</span> desc)
  ) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">guides</span>(alpha <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, color <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#f92672">~</span>shot_made_flag) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme</span>(
    axis.text <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    axis.title <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    panel.grid <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    axis.ticks <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    panel.background <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    strip.text <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(size <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>),
    legend.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">bottom&#34;</span>
  ) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">scale_fill_viridis_c</span>(option <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">magma&#34;</span>)
</code></pre></div><p><!-- raw HTML omitted --></p>
<p>Grafíco 3D de la distribución de tiros.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">kd_shots <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">with</span>(
  <span style="color:#a6e22e">subset</span>(shots_data, action_type <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Jump Shot&#34;</span> <span style="color:#f92672">&amp;</span> shot_made_flag <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>),
  MASS<span style="color:#f92672">::</span><span style="color:#a6e22e">kde2d</span>(loc_x, loc_y, n <span style="color:#f92672">=</span> <span style="color:#ae81ff">30</span>)
  )

plotly<span style="color:#f92672">::</span><span style="color:#a6e22e">plot_ly</span>(x <span style="color:#f92672">=</span> kd_shots<span style="color:#f92672">$</span>x, y <span style="color:#f92672">=</span> kd_shots<span style="color:#f92672">$</span>y, z <span style="color:#f92672">=</span> kd_shots<span style="color:#f92672">$</span>z) <span style="color:#f92672">%&gt;%</span> plotly<span style="color:#f92672">::</span><span style="color:#a6e22e">add_surface</span>()
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Otra forma de verlo es usando usando la geometría <code>geom_raster()</code>. Esta se usó una vez en la publicación sobre <a href="https://www.johan-rosa.com/post/analisis-de-las-defunciones-en-republica-dominicana/">las defunciones en República Dominicana</a>.</p>
<p>En estos casos solo se grafican los jump shots porque incluir otros, como dunks, que fueron muchos y casi no los fallaba, le quita un poco de gracia a la visualización.</p>
<p>En general Kobe no transformó considerablemente su selección de tiro a lo largo de su carrera.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">#c(&#34;1999-00&#34;, &#34;2000-01&#34;, &#34;2001-02&#34;, &#34;2008-09&#34;, &#34;2009-10&#34;)</span>

shots_data <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">filter</span>(combined_shot_type <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Jump Shot&#34;</span>,
         shot_zone_basic <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Backcourt&#34;</span>,
         season <span style="color:#f92672">%in%</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">2008-09&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">2009-10&#34;</span>),
         <span style="color:#f92672">!</span><span style="color:#a6e22e">is.na</span>(shot_made_flag))<span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">ggplot</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">stat_density2d</span>(
    <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> loc_x,
        y <span style="color:#f92672">=</span> loc_y,
        fill <span style="color:#f92672">=</span> <span style="color:#a6e22e">stat</span>(density<span style="color:#f92672">/</span> <span style="color:#a6e22e">max</span>(density))),
    geom <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">raster&#34;</span>,
    contour <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>,
    interpolate <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>,
    n <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_path</span>(
    data <span style="color:#f92672">=</span> court_points,
    <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> x, y <span style="color:#f92672">=</span> y, group <span style="color:#f92672">=</span> desc),
    color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">white&#34;</span>
  ) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#f92672">~</span>season) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_fill_viridis_c</span>(
      <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Frecuencia&#34;</span>,
      limits <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>),
      breaks <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">1</span>),
      labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">baja&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">media&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">alta&#34;</span>),
      option <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">magma&#34;</span>,
      guide <span style="color:#f92672">=</span> <span style="color:#a6e22e">guide_colorbar</span>(barwidth <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>)
    )  <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme</span>(
    axis.text <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    axis.title <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    panel.grid <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    axis.ticks <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    panel.background <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    strip.text <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(size <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>),
    legend.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">bottom&#34;</span>
  ) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">coord_cartesian</span>(expand <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
</code></pre></div><p><!-- raw HTML omitted --></p>
<p>Un gráfico más, ahora con los trableritos y los ganchos. En estos gráficos queda claro que tomaba los ganchos desde el centro y los tableritos del lado derecho, el lado de su mano dominante.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">shots_data <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">filter</span>(combined_shot_type <span style="color:#f92672">%in%</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Bank Shot&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Hook Shot&#34;</span>), shot_zone_basic <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Backcourt&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">mutate</span>(
    combined_shot_type <span style="color:#f92672">=</span> <span style="color:#a6e22e">factor</span>(
      combined_shot_type,
      levels <span style="color:#f92672">=</span>  <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Bank Shot&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Hook Shot&#34;</span>),
      labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Tableritos&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Ganchos&#34;</span>))
  ) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">ggplot</span>() <span style="color:#f92672">+</span>
        <span style="color:#a6e22e">stat_density2d</span>(
          <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> loc_x,
              y <span style="color:#f92672">=</span> loc_y,
              fill <span style="color:#f92672">=</span> <span style="color:#a6e22e">stat</span>(density<span style="color:#f92672">/</span> <span style="color:#a6e22e">max</span>(density))),
          geom <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">raster&#34;</span>,
          contour <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>,
          interpolate <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>,
          n <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>
          ) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#f92672">~</span>combined_shot_type, scales <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">free&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_path</span>(
    data <span style="color:#f92672">=</span> court_points,
    <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> x, y <span style="color:#f92672">=</span> y, group <span style="color:#f92672">=</span> desc),
    color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">white&#34;</span>
  )  <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_fill_viridis_c</span>(
      <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Frecuencia de tiro&#34;</span>,
      limits <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>),
      breaks <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>),
      labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">baja&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">alta&#34;</span>),
      option <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">magma&#34;</span>,
      guide <span style="color:#f92672">=</span> <span style="color:#a6e22e">guide_colorbar</span>(barwidth <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>)
    )  <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme</span>(
    axis.text <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    axis.title <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    panel.grid <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    axis.ticks <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    panel.background <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>(),
    strip.text <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(size <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>),
    legend.position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">bottom&#34;</span>
  ) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">coord_cartesian</span>(expand <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
</code></pre></div><p><!-- raw HTML omitted --></p>
<p>El tipo de tiro es una variable muy interesante y que sin dudas tendrán un protagonismo mayor a la hora de hacer el ejercicio de clasificación de los tiros para la competencia.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">shots_data <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">group_by</span>(combined_shot_type) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">summarise</span>(
    cantidad <span style="color:#f92672">=</span> <span style="color:#a6e22e">n</span>(),
    eficiencia <span style="color:#f92672">=</span> <span style="color:#a6e22e">mean</span>(shot_made_flag, na.rm <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
  ) <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">arrange</span>(<span style="color:#a6e22e">desc</span>(cantidad))
</code></pre></div><pre><code>## # A tibble: 6 x 3
##   combined_shot_type cantidad eficiencia
##   &lt;chr&gt;                 &lt;int&gt;      &lt;dbl&gt;
## 1 Jump Shot             23485      0.391
## 2 Layup                  5448      0.565
## 3 Dunk                   1286      0.928
## 4 Tip Shot                184      0.349
## 5 Hook Shot               153      0.535
## 6 Bank Shot               141      0.792
</code></pre><p>Ahora unas cuanta visualizaciones de kobe en el clutch. El siguiente gráfico analiza la cantidad de tiro que tomaba en cada minuto del último cuarto. No es de sorprender que al principio del último período tomara pocos tiros, porque normalmente a los estelares los denscansan al principio para aprovecharlos al final del juego.</p>
<p>En el caso de Kobe, claramente, los últimos 6 minutos del último período eran para él, sobre todo el último minuto.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">shots_data <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">filter</span>(period <span style="color:#f92672">==</span> <span style="color:#ae81ff">4</span>) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(minutes_remaining) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">summarise</span>(
    tiros <span style="color:#f92672">=</span> <span style="color:#a6e22e">n</span>(),
    eficiencia <span style="color:#f92672">=</span> <span style="color:#a6e22e">mean</span>(shot_made_flag, na.rm <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
    ) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">ggplot</span>(<span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> minutes_remaining, y <span style="color:#f92672">=</span> tiros)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_point</span>(size <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">midnightblue&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_text</span>(<span style="color:#a6e22e">aes</span>(label <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#a6e22e">round</span>(eficiencia<span style="color:#f92672">*</span><span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">1</span>), <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%&#34;</span>),
                vjust <span style="color:#f92672">=</span> <span style="color:#ae81ff">-1</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_x_reverse</span>(breaks <span style="color:#f92672">=</span> <span style="color:#ae81ff">11</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_minimal</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">coord_cartesian</span>(ylim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">300</span>, <span style="color:#ae81ff">1000</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Minutos restantes&#34;</span>,
       y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Cantidad de tiros&#34;</span>,
       title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Tiros tomados en cada minutos del último cuarto y eficiencia&#34;</span>,
       subtitle <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Nadie tiraba más que Kobe en el clutch&#34;</span>)
</code></pre></div><p><!-- raw HTML omitted --></p>
<h2 id="comentarios-finales">Comentarios finales</h2>
<p>Con este básico análisis exploratorio se sientan las bases para modelar los tiros de Kobe y tratar de clasificar los 5,000 intentos que vienen con <code>shot_made_flag</code> missing.</p>
<h2 id="referencias">Referencias</h2>
<p><a href="https://toddwschneider.com/posts/ballr-interactive-nba-shot-charts-with-r-and-shiny/">https://toddwschneider.com/posts/ballr-interactive-nba-shot-charts-with-r-and-shiny/</a>
<a href="https://www.kaggle.com/apapiu/exploring-kobe-s-shots">https://www.kaggle.com/apapiu/exploring-kobe-s-shots</a>
<a href="https://www.r-graph-gallery.com/2d-density-chart.html">https://www.r-graph-gallery.com/2d-density-chart.html</a>
<a href="https://www.kaggle.com/dansbecker/nba-shot-logs">https://www.kaggle.com/dansbecker/nba-shot-logs</a>
<a href="https://github.com/toddwschneider/nba-shots-db">https://github.com/toddwschneider/nba-shots-db</a></p>


                

                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/post/pir%C3%A1mides-de-poblaci%C3%B3n-con-ggplot2/" data-toggle="tooltip" data-placement="top" title="Pirámides de población con ggplot2">&larr;
                            Post anterior</a>
                    </li>
                    
                    
                </ul>

                <div id="disqus_thread"></div>
<script>
(function() {
var d = document, s = d.createElement('script');
s.src = 'https://johan-blog.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

            </div>
            
            <div class="
                col-lg-11 col-lg-offset-1
                col-md-10 col-md-offset-1
                sidebar-container">

                
                

                
                
                <section>
                    <hr>
                    <h5>Colegas</h5>
                    <ul class="list-inline">
                        
                        <li><a target="_blank" href="http://betaeconomia.blogspot.com/">Nerys Ramírez</a></li>
                        
                    </ul>
                </section>
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                    
                    <li>
                        <a href="mailto:johan.rosaperez@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    

                    

		    
                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/johan-rosa">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/johan-rosa-72bb0484/">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    <li>
                        <a target="_blank" href="https://stackoverflow.com/users/10266675/johan-rosa">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-stack-overflow fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
            
                    
                    
                    
            
                </ul>
		<p class="copyright text-muted">
                    Copyright &copy; Johan Rosa 2020
                    <br>
                    <a href="https://themes.gohugo.io/hugo-theme-cleanwhite">CleanWhite Hugo Theme</a> by <a href="https://zhaohuabing.com">Huabing</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    async("https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>






<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-151896571-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</body>
</html>
